# =============================================================================
# Shared ConfigMap - 모든 서비스가 공유하는 설정
# =============================================================================
# 이 ConfigMap은 서비스 간 통신 URL, 공통 설정 등을 중앙 관리합니다.
# 각 서비스의 Deployment에서 envFrom으로 참조합니다.
#
# 사용법 (각 서비스 deployment.yaml):
#   envFrom:
#     - configMapRef:
#         name: wealist-config
#
# 업그레이드 경로:
#   1. 현재: K8s ConfigMap (수동 관리)
#   2. 다음: External Secrets + AWS Secrets Manager
#   3. 고급: HashiCorp Vault + Vault Agent Injector

apiVersion: v1
kind: ConfigMap
metadata:
  name: wealist-config
  labels:
    app.kubernetes.io/name: wealist
    app.kubernetes.io/component: shared-config
data:
  # ===========================================================================
  # Environment
  # ===========================================================================
  ENV: "dev"
  LOG_LEVEL: "debug"

  # ===========================================================================
  # Service Discovery URLs (K8s 내부 DNS)
  # 형식: <service-name>.<namespace>.svc.cluster.local:<port>
  # 같은 namespace면 <service-name>:<port>로 충분
  # ===========================================================================
  AUTH_SERVICE_URL: "http://auth-service:8080"
  USER_SERVICE_URL: "http://user-service:8081"
  BOARD_SERVICE_URL: "http://board-service:8000"
  CHAT_SERVICE_URL: "http://chat-service:8001"
  NOTI_SERVICE_URL: "http://noti-service:8002"
  STORAGE_SERVICE_URL: "http://storage-service:8003"
  VIDEO_SERVICE_URL: "http://video-service:8004"
  LIVEKIT_WS_URL: "wss://__PUBLIC_DOMAIN__/svc/livekit"

  # ===========================================================================
  # Infrastructure URLs (K8s 내부)
  # ===========================================================================
  # PostgreSQL (각 서비스별 DB는 개별 설정)
  POSTGRES_HOST: "postgres"
  POSTGRES_PORT: "5432"

  # Redis
  REDIS_HOST: "redis"
  REDIS_PORT: "6379"

  # MinIO (S3 호환)
  S3_ENDPOINT: "http://minio:9000"
  S3_PUBLIC_ENDPOINT: "http://minio:9000"  # 기본값 (overlay에서 반드시 오버라이드 필요)
  S3_BUCKET: "wealist-files"
  S3_REGION: "ap-northeast-2"

  # ===========================================================================
  # CORS & Security
  # ===========================================================================
  CORS_ORIGINS: "*"

  # ===========================================================================
  # Internal API (서비스 간 통신용)
  # ===========================================================================
  INTERNAL_API_KEY: "internal-dev-key-change-in-production"
