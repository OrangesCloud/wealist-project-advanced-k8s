# wealist-argo-helm

ì´ í”„ë¡œì íŠ¸ëŠ” Helm Chartì™€ ArgoCDë¥¼ ì‚¬ìš©í•˜ì—¬ Wealist ì„œë¹„ìŠ¤ë¥¼ ë°°í¬í•˜ëŠ” ì €ì¥ì†Œì…ë‹ˆë‹¤.

## ğŸ“ í”„ë¡œì íŠ¸ êµ¬ì¡°

- **charts/** - ê° ì„œë¹„ìŠ¤ë³„ ê°œë³„ Helm Chart
- **environments/** - í™˜ê²½ë³„ ì„¤ì • íŒŒì¼ (localhost, dev, prod)
  - Chart í…œí”Œë¦¿ì€ ë³€ê²½í•˜ì§€ ì•Šê³ , ëª¨ë“  í™˜ê²½ì—ì„œ ê³µí†µìœ¼ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤
  - í™˜ê²½ë³„ë¡œ ë‹¤ë¥¸ ê°’ë“¤ë§Œ ì´ ë””ë ‰í† ë¦¬ì—ì„œ ê´€ë¦¬í•©ë‹ˆë‹¤

> âš ï¸ **ì¤‘ìš”**: ë°°í¬ ì „ì— ê° í™˜ê²½ì˜ `secret` íŒŒì¼ì— í™˜ê²½ë³€ìˆ˜ ê°’ì„ ë°˜ë“œì‹œ ì„¤ì •í•´ì•¼ í•©ë‹ˆë‹¤.

---

## ğŸš€ ë¹ ë¥¸ ì‹œì‘ ê°€ì´ë“œ

Kind í´ëŸ¬ìŠ¤í„°ì—ì„œ Wealist ì„œë¹„ìŠ¤ë¥¼ ë°°í¬í•˜ëŠ” ë‘ ê°€ì§€ ë°©ë²•ì´ ìˆìŠµë‹ˆë‹¤.

| í™˜ê²½          | ì´ë¯¸ì§€ ë ˆì§€ìŠ¤íŠ¸ë¦¬                  | ë°ì´í„°ë² ì´ìŠ¤        | ì‚¬ìš© ëª©ì                               |
| ------------- | ---------------------------------- | ------------------- | -------------------------------------- |
| **localhost** | ë¡œì»¬ ë ˆì§€ìŠ¤íŠ¸ë¦¬ (`localhost:5001`) | í´ëŸ¬ìŠ¤í„° ë‚´ë¶€ Pod   | ë¡œì»¬ì—ì„œ ì§ì ‘ ë¹Œë“œí•œ ì´ë¯¸ì§€ë¡œ í…ŒìŠ¤íŠ¸   |
| **dev**       | AWS ECR                            | í˜¸ìŠ¤íŠ¸ PC (ì™¸ë¶€ DB) | CI/CDë¡œ ë¹Œë“œëœ ì´ë¯¸ì§€ë¡œ ê°œë°œ í™˜ê²½ êµ¬ì„± |

---

## ğŸ  ë°©ë²• 1: Localhost í™˜ê²½ ë°°í¬

ë¡œì»¬ì—ì„œ ë¹Œë“œí•œ Docker ì´ë¯¸ì§€ë¥¼ ì‚¬ìš©í•˜ì—¬ ë°°í¬í•©ë‹ˆë‹¤. ëª¨ë“  ì»´í¬ë„ŒíŠ¸(DB í¬í•¨)ê°€ í´ëŸ¬ìŠ¤í„° ë‚´ë¶€ì—ì„œ ì‹¤í–‰ë©ë‹ˆë‹¤.

### Step 1. Kind í´ëŸ¬ìŠ¤í„° ë° ë¡œì»¬ ë ˆì§€ìŠ¤íŠ¸ë¦¬ ìƒì„±

```bash
make kind-localhost-setup
```

**ì´ ëª…ë ¹ì–´ê°€ ìˆ˜í–‰í•˜ëŠ” ì‘ì—…:**

| ë‹¨ê³„ | ì‘ì—… ë‚´ìš©                                                                                                      |
| ---- | -------------------------------------------------------------------------------------------------------------- |
| 0    | **í•„ìˆ˜ ë„êµ¬ í™•ì¸** - kubectl, kind, helm, istioctl ì„¤ì¹˜ ì—¬ë¶€ í™•ì¸ (ë¯¸ì„¤ì¹˜ ì‹œ ìë™ ì„¤ì¹˜)                        |
| 1    | **Secrets íŒŒì¼ í™•ì¸** - `secrets.yaml` ì—†ìœ¼ë©´ `secrets.example.yaml`ì—ì„œ ìë™ ìƒì„±                             |
| 2    | **Kind í´ëŸ¬ìŠ¤í„° ìƒì„±** - í´ëŸ¬ìŠ¤í„° + Istio Sidecar ëª¨ë“œ + ë¡œì»¬ ë ˆì§€ìŠ¤íŠ¸ë¦¬(`localhost:5001`) ì„¤ì •                |
| 3    | **ëª¨ë“  ì´ë¯¸ì§€ ë¡œë“œ** - PostgreSQL, Redis, MinIO ë“± ì¸í”„ë¼ ì´ë¯¸ì§€ + Backend/Frontend ì„œë¹„ìŠ¤ ì´ë¯¸ì§€ ë¹Œë“œ ë° ë¡œë“œ |

### Step 2. Docker ì´ë¯¸ì§€ ë¹Œë“œ ë° í‘¸ì‹œ (ì„ íƒì‚¬í•­)

ì„œë¹„ìŠ¤ ì½”ë“œ ìˆ˜ì • í›„ ì§ì ‘ ë¹Œë“œê°€ í•„ìš”í•œ ê²½ìš°:

```bash
# ì˜ˆì‹œ: ì„œë¹„ìŠ¤ ì´ë¯¸ì§€ ë¹Œë“œ ë° í‘¸ì‹œ
docker build -t localhost:5001/service-name:latest .
docker push localhost:5001/service-name:latest
```

ì´ë¯¸ì§€ ì—…ë¡œë“œ í™•ì¸:

```bash
curl -s http://localhost:5001/v2/_catalog | jq
```

### Step 3. Helm ì°¨íŠ¸ ë°°í¬

```bash
make helm-install-all ENV=localhost
```

**ì´ ëª…ë ¹ì–´ê°€ ìˆ˜í–‰í•˜ëŠ” ì‘ì—…:**

| ë‹¨ê³„ | ì‘ì—… ë‚´ìš©                                                                                       |
| ---- | ----------------------------------------------------------------------------------------------- |
| 1    | **Secrets ì²´í¬** - `secrets.yaml` íŒŒì¼ ì¡´ì¬ ì—¬ë¶€ í™•ì¸                                           |
| 2    | **DB ì²´í¬ ìŠ¤í‚µ** - localhostëŠ” ë‚´ë¶€ Pod ì‚¬ìš©ì´ë¯€ë¡œ ì™¸ë¶€ DB ì²´í¬ ìƒëµ                            |
| 3    | **Helm ì˜ì¡´ì„± ë¹Œë“œ** - ëª¨ë“  ì°¨íŠ¸ì˜ ì˜ì¡´ì„± ì—…ë°ì´íŠ¸                                              |
| 4    | **cert-manager ì„¤ì¹˜** - í™˜ê²½ì—ì„œ í™œì„±í™”ëœ ê²½ìš°ì—ë§Œ ì„¤ì¹˜                                         |
| 5    | **ì¸í”„ë¼ ì„¤ì¹˜** - PostgreSQL, Redis Pod + MinIO, LiveKit ë“±                                     |
| 6    | **ì„œë¹„ìŠ¤ ì„¤ì¹˜** - auth, user, board, chat, noti, storage, video ì„œë¹„ìŠ¤ (DB auto-migrate í™œì„±í™”) |
| 7    | **Frontend ì„¤ì¹˜** - localhost.yamlì—ì„œ `frontend.enabled=true`ì¸ ê²½ìš°                           |
| 8    | **Istio ì„¤ì •** - HTTPRoute, DestinationRules, PeerAuthentication                                |
| 9    | **Istio Addons** - Kiali, Jaeger (ì„œë¹„ìŠ¤ ë©”ì‹œ ê´€ì¸¡ì„±)                                           |
| 10   | **ëª¨ë‹ˆí„°ë§ ìŠ¤íƒ** - Prometheus, Grafana, Loki                                                   |

âœ… **Localhost í™˜ê²½ ë°°í¬ ì™„ë£Œ!**

---

## ğŸŒ ë°©ë²• 2: Dev í™˜ê²½ ë°°í¬

AWS ECRì— ìˆëŠ” ì´ë¯¸ì§€ë¥¼ ì‚¬ìš©í•˜ê³ , í˜¸ìŠ¤íŠ¸ PCì˜ PostgreSQL/Redisë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.

### Step 1. Kind í´ëŸ¬ìŠ¤í„° ìƒì„±

```bash
make kind-dev-setup
```

**ì´ ëª…ë ¹ì–´ê°€ ìˆ˜í–‰í•˜ëŠ” ì‘ì—…:**

| ë‹¨ê³„ | ì‘ì—… ë‚´ìš©                                                                                           |
| ---- | --------------------------------------------------------------------------------------------------- |
| 1    | **í•„ìˆ˜ ë„êµ¬ í™•ì¸** - kubectl, kind, helm, istioctl, AWS CLI ì„¤ì¹˜ ì—¬ë¶€ í™•ì¸                          |
| 2    | **Secrets íŒŒì¼ í™•ì¸** - `secrets.yaml` ì—†ìœ¼ë©´ ìë™ ìƒì„±                                             |
| 3    | **AWS ë¡œê·¸ì¸ í™•ì¸** - ECR ì ‘ê·¼ì„ ìœ„í•œ AWS ìê²©ì¦ëª… í™•ì¸/ì„¤ì •                                        |
| 4    | **Kind í´ëŸ¬ìŠ¤í„° ìƒì„±** - í´ëŸ¬ìŠ¤í„° + Istio Sidecar + ECR Secret ìƒì„±                                 |
| 5    | **ì™¸ë¶€ DB ì—°ê²° í…ŒìŠ¤íŠ¸** - í˜¸ìŠ¤íŠ¸ PCì˜ PostgreSQL(172.18.0.1:5432), Redis(172.18.0.1:6379) ì—°ê²° í™•ì¸ |
| 6    | **ì¸í”„ë¼ ì´ë¯¸ì§€ ë¡œë“œ** - MinIO, LiveKit ë“± (DB ì´ë¯¸ì§€ ì œì™¸)                                         |
| 7    | **ECR ì´ë¯¸ì§€ í™•ì¸** - ê° ì„œë¹„ìŠ¤ì˜ `dev-latest` íƒœê·¸ ì´ë¯¸ì§€ ì¡´ì¬ ì—¬ë¶€ í™•ì¸                           |
| 8    | **ArgoCD ì„¤ì¹˜** - GitOps ìë™ ë°°í¬ ì„¤ì •                                                             |

### Step 2. Helm ì°¨íŠ¸ ë°°í¬

```bash
make helm-install-all ENV=dev
```

**ì´ ëª…ë ¹ì–´ê°€ ìˆ˜í–‰í•˜ëŠ” ì‘ì—…:**

| ë‹¨ê³„ | ì‘ì—… ë‚´ìš©                                                                           |
| ---- | ----------------------------------------------------------------------------------- |
| 1    | **Secrets ì²´í¬** - `secrets.yaml` íŒŒì¼ ì¡´ì¬ ì—¬ë¶€ í™•ì¸                               |
| 2    | **DB ì—°ê²° ì²´í¬** - í˜¸ìŠ¤íŠ¸ PCì˜ PostgreSQL/Redis ì‹¤í–‰ ìƒíƒœ í™•ì¸                      |
| 3    | **Helm ì˜ì¡´ì„± ë¹Œë“œ** - ëª¨ë“  ì°¨íŠ¸ì˜ ì˜ì¡´ì„± ì—…ë°ì´íŠ¸                                  |
| 4    | **cert-manager ì„¤ì¹˜** - TLS ì¸ì¦ì„œ ìë™ ë°œê¸‰ (í™œì„±í™”ëœ ê²½ìš°)                        |
| 5    | **ì¸í”„ë¼ ì„¤ì¹˜** - ì™¸ë¶€ DB ì—°ê²° ì„¤ì • (postgres.enabled=false, external.enabled=true) |
| 6    | **ì„œë¹„ìŠ¤ ì„¤ì¹˜** - ECRì—ì„œ ì´ë¯¸ì§€ pull, AWS Account ID ìë™ ì„¤ì •                     |
| 7    | **Istio ì„¤ì •** - HTTPRoute, DestinationRules, PeerAuthentication                    |
| 8    | **Istio Addons** - Kiali, Jaeger                                                    |
| 9    | **ëª¨ë‹ˆí„°ë§ ìŠ¤íƒ** - Prometheus, Grafana, Loki (ì™¸ë¶€ DB exporter ì„¤ì •)               |

âœ… **Dev í™˜ê²½ ë°°í¬ ì™„ë£Œ!**

---

## ğŸ“‹ í™˜ê²½ë³„ ë¹„êµ

| í•­ëª©              | Localhost                             | Dev                             |
| ----------------- | ------------------------------------- | ------------------------------- |
| **í´ëŸ¬ìŠ¤í„° ìƒì„±** | `make kind-localhost-setup`           | `make kind-dev-setup`           |
| **Helm ë°°í¬**     | `make helm-install-all ENV=localhost` | `make helm-install-all ENV=dev` |
| **ì´ë¯¸ì§€ ì†ŒìŠ¤**   | ë¡œì»¬ ë ˆì§€ìŠ¤íŠ¸ë¦¬ (`localhost:5001`)    | AWS ECR                         |
| **ì´ë¯¸ì§€ ë¹Œë“œ**   | ì§ì ‘ ë¹Œë“œ í•„ìš”                        | GitHub Actions ìë™ ë¹Œë“œ        |
| **ë°ì´í„°ë² ì´ìŠ¤**  | í´ëŸ¬ìŠ¤í„° ë‚´ë¶€ Pod                     | í˜¸ìŠ¤íŠ¸ PC (ì™¸ë¶€ DB)             |
| **ArgoCD**        | ë¯¸ì„¤ì¹˜                                | ìë™ ì„¤ì¹˜                       |
| **ì í•©í•œ ìƒí™©**   | ë¡œì»¬ ê°œë°œ ë° í…ŒìŠ¤íŠ¸                   | CI/CD í†µí•© í…ŒìŠ¤íŠ¸               |

---

## ğŸ“Š ë°°í¬ í›„ ì ‘ì† ì •ë³´

### ì„œë¹„ìŠ¤ ì ‘ì†

- **Gateway**: `http://localhost:80` (ë˜ëŠ” `:8080`)

### ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ

| ì„œë¹„ìŠ¤     | URL                                               |
| ---------- | ------------------------------------------------- |
| Grafana    | `http://localhost:8080/api/monitoring/grafana`    |
| Prometheus | `http://localhost:8080/api/monitoring/prometheus` |
| Kiali      | `http://localhost:8080/api/monitoring/kiali`      |
| Jaeger     | `http://localhost:8080/api/monitoring/jaeger`     |

### ArgoCD (dev í™˜ê²½ë§Œ)

- **URL**: `https://localhost:8079`
- **User**: `admin`
- **Password**: `kubectl -n argocd get secret argocd-initial-admin-secret -o jsonpath="{.data.password}" | base64 -d`

---

## ğŸ” í´ëŸ¬ìŠ¤í„° ì •ë³´ í™•ì¸

### ë°°í¬ ì •ë³´ í™•ì¸

```bash
make kind-info
```

**ì¶œë ¥ ì •ë³´:**

- Git Repository (Repo, Branch, Commit)
- ë°°í¬ì ì •ë³´ (Name, Email, Time)
- í´ëŸ¬ìŠ¤í„° ì„¤ì • (Namespace, Istio ëª¨ë“œ)

### ë°°í¬ ì •ë³´ ì—…ë°ì´íŠ¸

```bash
make kind-info-update
```

**ìˆ˜í–‰ ì‘ì—…:**

- í˜„ì¬ Git ì •ë³´ (repo, branch, commit)ë¥¼ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ annotationì— ê¸°ë¡
- ë°°í¬ì ì •ë³´ (git config user.name, user.email) ê¸°ë¡
- ë°°í¬ ì‹œê°„ ê¸°ë¡

---

## ğŸ’¡ ì£¼ìš” ì°¸ê³ ì‚¬í•­

- Chart í…œí”Œë¦¿ì€ ìˆ˜ì •í•˜ì§€ ë§ê³ , `environments/` ë””ë ‰í† ë¦¬ì˜ ê°’ë§Œ ìˆ˜ì •í•˜ì„¸ìš”
- í™˜ê²½ë³„ ì‹œí¬ë¦¿ ì„¤ì •ì„ ìŠì§€ ë§ˆì„¸ìš”
- í´ëŸ¬ìŠ¤í„° ì‚­ì œ: `kind delete cluster --name wealist`
- ìƒíƒœ í™•ì¸: `make status`
- Pod ë¡œê·¸: `kubectl logs -n <namespace> <pod-name>`
