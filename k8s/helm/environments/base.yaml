# =============================================================================
# Helm Base Configuration - Common defaults for all environments
# =============================================================================
# This file contains shared configuration inherited by all environments.
# Override specific values in environment-specific files (local-kind.yaml, etc.)

# -----------------------------------------------------------------------------
# Global Settings (override per environment)
# -----------------------------------------------------------------------------
global:
  namespace: wealist-dev
  environment: develop
  domain: localhost
  imageRegistry: localhost:5001

# -----------------------------------------------------------------------------
# Default Deployment Settings
# -----------------------------------------------------------------------------
# replicaCount: 1

image:
  pullPolicy: IfNotPresent

# -----------------------------------------------------------------------------
# Default Resource Limits - Use service-specific defaults
# -----------------------------------------------------------------------------
# Note: Removed global resource override. Each service uses its own values:
# - Go services: 128Mi-256Mi (fast, low memory)
# - auth-service (Spring Boot): 512Mi-1Gi (JVM needs more memory)
# Overriding globally caused OOMKilled for Spring Boot services.

# -----------------------------------------------------------------------------
# Health Check Settings - Use service-specific defaults
# -----------------------------------------------------------------------------
# Note: Removed global healthCheck to allow each service to define its own values.
# This is important because:
# - Go services: Fast startup (~5-10s)
# - auth-service (Spring Boot): Slow startup (~40-60s)
# See each service's values.yaml for their healthCheck configuration.

# -----------------------------------------------------------------------------
# Autoscaling (disabled by default, enable in prod)
# -----------------------------------------------------------------------------
autoscaling:
  enabled: false
  minReplicas: 2
  maxReplicas: 10
  targetCPUUtilizationPercentage: 80

# -----------------------------------------------------------------------------
# Security Context Defaults (production-ready)
# -----------------------------------------------------------------------------
podSecurityContext:
  runAsNonRoot: true
  fsGroup: 1000

securityContext:
  allowPrivilegeEscalation: false
  runAsNonRoot: true
  readOnlyRootFilesystem: true
  capabilities:
    drop:
      - ALL

# -----------------------------------------------------------------------------
# Service Account
# -----------------------------------------------------------------------------
serviceAccount:
  create: false
  name: ""
  annotations: {}

# -----------------------------------------------------------------------------
# Network Policy (disabled by default, enable in prod)
# -----------------------------------------------------------------------------
networkPolicy:
  enabled: false

# -----------------------------------------------------------------------------
# Pod Disruption Budget (disabled by default, enable in prod)
# -----------------------------------------------------------------------------
podDisruptionBudget:
  enabled: false
  minAvailable: 1

# -----------------------------------------------------------------------------
# Metrics & Monitoring
# -----------------------------------------------------------------------------
metrics:
  enabled: true
  port: 9090
  path: /metrics

# -----------------------------------------------------------------------------
# Pod Annotations
# -----------------------------------------------------------------------------
podAnnotations: {}

# -----------------------------------------------------------------------------
# Node Selector & Tolerations (for prod)
# -----------------------------------------------------------------------------
nodeSelector: {}
tolerations: []
affinity: {}

# -----------------------------------------------------------------------------
# Shared Configuration (used by config templates)
# -----------------------------------------------------------------------------
# These values are available to all services via shared.config (ConfigMap)
# Service-specific config in charts/*/values.yaml will override these
#
# IMPORTANT: Sensitive data goes to shared.secrets (Secret), not here!
shared:
  config:
    # Environment
    ENV: "production"
    LOG_LEVEL: "info"

    # Infrastructure URLs (K8s internal DNS)
    POSTGRES_HOST: "postgres"
    POSTGRES_PORT: "5432"
    DB_HOST: "postgres"
    DB_PORT: "5432"
    DB_USER: "postgres"
    DB_SSLMODE: "disable"
    REDIS_HOST: "redis"
    REDIS_PORT: "6379"

    # Service URLs
    AUTH_SERVICE_URL: "http://auth-service:8080"
    USER_SERVICE_URL: "http://user-service:8081"
    BOARD_SERVICE_URL: "http://board-service:8000"
    CHAT_SERVICE_URL: "http://chat-service:8001"
    NOTI_SERVICE_URL: "http://noti-service:8002"
    STORAGE_SERVICE_URL: "http://storage-service:8003"
    VIDEO_SERVICE_URL: "http://video-service:8004"

    # S3/MinIO Configuration (non-sensitive)
    S3_ENDPOINT: "http://minio:9000"
    S3_PUBLIC_ENDPOINT: "http://minio:9000"
    S3_BUCKET: "wealist-files"
    S3_REGION: "ap-northeast-2"

    # CORS
    CORS_ORIGINS: "*"

    # OAuth2 Redirect URLs (override per environment)
    OAUTH2_CLIENT_REDIRECT_URI: "http://localhost/login/oauth2/code/google"
    OAUTH2_REDIRECT_URL_ENV: "http://localhost/oauth/callback"

    # LiveKit (WebRTC) - non-sensitive
    LIVEKIT_URL: "http://livekit:7880"
    LIVEKIT_WS_URL: "ws://localhost/svc/livekit"

    # Database Migration (default: disabled for safety)
    DB_AUTO_MIGRATE: "false"

  # ---------------------------------------------------------------------------
  # Shared Secrets (stored in K8s Secret, base64 encoded)
  # ---------------------------------------------------------------------------
  # Override in environment-specific files or use External Secrets Operator
  # For production: use helm/environments/secrets-prod.yaml (gitignored)
  secrets:
    # Database
    DB_PASSWORD: "postgres"
    REDIS_PASSWORD: ""

    # S3/MinIO Credentials
    S3_ACCESS_KEY: "minioadmin"
    S3_SECRET_KEY: "minioadmin"

    # Security
    INTERNAL_API_KEY: "internal-key-change-me"
    JWT_SECRET: "dev-jwt-secret-change-in-production"

    # OAuth2 Credentials (placeholder for local)
    GOOGLE_CLIENT_ID: "placeholder-client-id.apps.googleusercontent.com"
    GOOGLE_CLIENT_SECRET: "placeholder-client-secret"

    # LiveKit Credentials
    LIVEKIT_API_KEY: "devkey"
    LIVEKIT_API_SECRET: "devsecret"
