{{- if .Values.grafana.enabled }}
{{- $files := .Files }}
# =============================================================================
# Grafana Dashboards V4 - Role-based Dashboard Configuration
# =============================================================================
# Structure (2026 Best Practice):
#   00-landing/    - System overview (entry point)
#   01-cicd/       - CI/CD dashboards (ArgoCD, GitHub Actions)
#   02-loadtest/   - Load testing dashboards (k6)
#   03-developer/  - Developer dashboards (API, traces, service graph)
#   04-pm/         - PM dashboards (business metrics, SLO)
#   05-operations/ - Operations dashboards (K8s, DB, incidents)
#   06-advanced/   - Advanced OTEL dashboards
# =============================================================================

---
# 00. Landing - System Entry Point
apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboards-v4-landing
  namespace: {{ .Values.global.namespace }}
  labels:
    app: grafana
    app.kubernetes.io/name: grafana
    app.kubernetes.io/component: monitoring
    grafana_dashboard: "1"
data:
  {{- range $path, $_ := .Files.Glob "dashboards-v4/00-landing/*.json" }}
  {{ base $path }}: |-
{{ $files.Get $path | indent 4 }}
  {{- end }}

---
# 01. CI/CD - ArgoCD, GitHub Actions
apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboards-v4-cicd
  namespace: {{ .Values.global.namespace }}
  labels:
    app: grafana
    app.kubernetes.io/name: grafana
    app.kubernetes.io/component: monitoring
    grafana_dashboard: "1"
data:
  {{- range $path, $_ := .Files.Glob "dashboards-v4/01-cicd/*.json" }}
  {{ base $path }}: |-
{{ $files.Get $path | indent 4 }}
  {{- end }}

---
# 02. LoadTest - k6 Performance Testing
apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboards-v4-loadtest
  namespace: {{ .Values.global.namespace }}
  labels:
    app: grafana
    app.kubernetes.io/name: grafana
    app.kubernetes.io/component: monitoring
    grafana_dashboard: "1"
data:
  {{- range $path, $_ := .Files.Glob "dashboards-v4/02-loadtest/*.json" }}
  {{ base $path }}: |-
{{ $files.Get $path | indent 4 }}
  {{- end }}

---
# 03. Developer - API Performance, Traces, Service Graph
apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboards-v4-developer
  namespace: {{ .Values.global.namespace }}
  labels:
    app: grafana
    app.kubernetes.io/name: grafana
    app.kubernetes.io/component: monitoring
    grafana_dashboard: "1"
data:
  {{- range $path, $_ := .Files.Glob "dashboards-v4/03-developer/*.json" }}
  {{ base $path }}: |-
{{ $files.Get $path | indent 4 }}
  {{- end }}

---
# 04. PM - Business Metrics, SLO Overview
apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboards-v4-pm
  namespace: {{ .Values.global.namespace }}
  labels:
    app: grafana
    app.kubernetes.io/name: grafana
    app.kubernetes.io/component: monitoring
    grafana_dashboard: "1"
data:
  {{- range $path, $_ := .Files.Glob "dashboards-v4/04-pm/*.json" }}
  {{ base $path }}: |-
{{ $files.Get $path | indent 4 }}
  {{- end }}

---
# 05. Operations - Kubernetes, Database, Incidents, Canary
apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboards-v4-operations
  namespace: {{ .Values.global.namespace }}
  labels:
    app: grafana
    app.kubernetes.io/name: grafana
    app.kubernetes.io/component: monitoring
    grafana_dashboard: "1"
data:
  {{- range $path, $_ := .Files.Glob "dashboards-v4/05-operations/*.json" }}
  {{ base $path }}: |-
{{ $files.Get $path | indent 4 }}
  {{- end }}

---
# 06. Advanced - OTEL Span Metrics, Traces, SLO Burndown
apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboards-v4-advanced
  namespace: {{ .Values.global.namespace }}
  labels:
    app: grafana
    app.kubernetes.io/name: grafana
    app.kubernetes.io/component: monitoring
    grafana_dashboard: "1"
data:
  {{- range $path, $_ := .Files.Glob "dashboards-v4/06-advanced/*.json" }}
  {{ base $path }}: |-
{{ $files.Get $path | indent 4 }}
  {{- end }}
{{- end }}
