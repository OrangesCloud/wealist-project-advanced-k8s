# =============================================================================
# weAlist Monitoring Stack - Local Development Values (Kind)
# =============================================================================
# Kind 환경에서 로컬 레지스트리를 사용하는 개발용 설정
#
# 사용법:
#   helm install wealist-monitoring ./helm/charts/wealist-monitoring \
#     -f ./helm/charts/wealist-monitoring/values-develop-registry-local.yaml \
#     -n wealist --create-namespace

# Global settings
global:
  namespace: wealist

# =============================================================================
# Prometheus - Metrics Collection
# =============================================================================
prometheus:
  enabled: true

  image:
    repository: prom/prometheus
    tag: "v2.48.0"
    pullPolicy: IfNotPresent

  replicas: 1

  service:
    type: ClusterIP
    port: 9090

  # Kind 환경에서는 hostPath 또는 local-path-provisioner 사용
  persistence:
    enabled: true
    storageClass: "standard"  # Kind default storage class
    size: 5Gi

  resources:
    requests:
      memory: "128Mi"
      cpu: "50m"
    limits:
      memory: "256Mi"
      cpu: "200m"

  config:
    scrapeInterval: 15s
    evaluationInterval: 15s
    retentionTime: 3d  # 개발 환경에서는 3일

  # 스크래핑 대상 서비스들
  scrapeTargets:
    userService:
      enabled: true
      host: user-service
      port: 8081
      path: /metrics
    boardService:
      enabled: true
      host: board-service
      port: 8000
      path: /metrics
    chatService:
      enabled: true
      host: chat-service
      port: 8001
      path: /metrics
    notiService:
      enabled: true
      host: noti-service
      port: 8002
      path: /metrics
    storageService:
      enabled: true
      host: storage-service
      port: 8003
      path: /metrics
    videoService:
      enabled: true
      host: video-service
      port: 8004
      path: /metrics
    authService:
      enabled: true
      host: auth-service
      port: 8080
      path: /actuator/prometheus

# =============================================================================
# Loki - Log Aggregation
# =============================================================================
loki:
  enabled: true

  image:
    repository: grafana/loki
    tag: "2.9.2"
    pullPolicy: IfNotPresent

  replicas: 1

  service:
    type: ClusterIP
    port: 3100

  persistence:
    enabled: true
    storageClass: "standard"
    size: 5Gi

  resources:
    requests:
      memory: "64Mi"
      cpu: "25m"
    limits:
      memory: "128Mi"
      cpu: "100m"

  config:
    retentionPeriod: 72h  # 개발 환경에서는 3일
    ingestionRateMB: 5
    ingestionBurstSizeMB: 10

# =============================================================================
# Promtail - Log Collector
# =============================================================================
promtail:
  enabled: true

  image:
    repository: grafana/promtail
    tag: "2.9.2"
    pullPolicy: IfNotPresent

  resources:
    requests:
      memory: "32Mi"
      cpu: "10m"
    limits:
      memory: "64Mi"
      cpu: "50m"

  config:
    lokiUrl: http://loki:3100/loki/api/v1/push

# =============================================================================
# Grafana - Visualization Dashboard
# =============================================================================
grafana:
  enabled: true

  image:
    repository: grafana/grafana
    tag: "10.2.2"
    pullPolicy: IfNotPresent

  replicas: 1

  service:
    type: NodePort
    port: 3000
    nodePort: 30001  # localhost:30001로 접근 가능

  persistence:
    enabled: true
    storageClass: "standard"
    size: 2Gi

  resources:
    requests:
      memory: "64Mi"
      cpu: "25m"
    limits:
      memory: "128Mi"
      cpu: "100m"

  # 개발용 Admin credentials
  admin:
    user: admin
    password: admin

  config:
    allowSignUp: false
