# Istio Addons Configuration
namespace: istio-system

# =============================================================================
# 이미지 레지스트리 설정
# =============================================================================
# 인프라 이미지는 Docker Hub에서 직접 사용
# 서비스 이미지는 AWS ECR에서 pull (별도 환경 설정)
imageRegistry: ""  # "" = Docker Hub 직접 사용

# =============================================================================
# 모니터링 네임스페이스 (Prometheus/Grafana가 설치된 곳)
# =============================================================================
# 빈 문자열 → global.namespace 사용 (환경 파일에서 설정)
# 환경별: wealist-kind-local, wealist-dev, wealist-prod
monitoringNamespace: ""

# Kiali - Service Mesh Dashboard
# Ambient 모드 지원을 위해 Kiali 2.x 필요
kiali:
  enabled: true
  image:
    repository: quay.io/kiali/kiali
    tag: v2.4  # Ambient 모드 지원을 위해 Kiali 2.x 사용
  service:
    type: ClusterIP
    port: 20001
  auth:
    strategy: anonymous  # anonymous, token, openid
  # wealist-monitoring의 Prometheus 참조 (cross-namespace)
  # Note: Prometheus has routePrefix configured
  prometheus:
    url: ""  # 템플릿에서 동적 생성
  # wealist-monitoring의 Grafana 참조 (cross-namespace)
  grafana:
    enabled: true
    url: ""  # 템플릿에서 동적 생성
  tracing:
    enabled: true
    url: "http://jaeger-query:16686"

# Jaeger - Distributed Tracing
jaeger:
  enabled: true
  allInOne: true  # For dev/test. Set false for production
  image:
    repository: jaegertracing/all-in-one
    tag: "1.52"
  service:
    collector:
      port: 14268
    query:
      port: 16686
    zipkin:
      port: 9411
  storage:
    type: memory  # memory, elasticsearch, cassandra
    # For production, use:
    # type: elasticsearch
    # elasticsearch:
    #   host: elasticsearch
    #   port: 9200

# Prometheus - Metrics (Istio telemetry)
# 참고: wealist-monitoring에서 이미 Prometheus를 설치하므로 여기서는 비활성화
# Kiali는 wealist-monitoring의 Prometheus를 참조함
prometheus:
  enabled: false
  image:
    repository: prom/prometheus
    tag: v2.48.0
  service:
    port: 9090
  retention: 6h
  scrapeInterval: 15s

# Grafana - Visualization
# 참고: wealist-monitoring에서 이미 Grafana를 설치하므로 여기서는 비활성화
grafana:
  enabled: false
  image:
    repository: grafana/grafana
    tag: "10.2.2"
  service:
    type: ClusterIP
    port: 3000
  adminUser: admin
  adminPassword: admin
  dashboards:
    istio: true

# =============================================================================
# ReferenceGrant - Cross-namespace routing
# =============================================================================
# HTTPRoute가 다른 네임스페이스에서 istio-system의 Kiali, Jaeger를 참조할 때 필요
referenceGrant:
  enabled: true
  # HTTPRoute를 허용할 네임스페이스 목록
  allowedNamespaces:
    - wealist-localhost
    - wealist-dev
    - wealist-dev
    - wealist-prod
