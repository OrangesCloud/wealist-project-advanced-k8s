apiVersion: v1
kind: ConfigMap
metadata:
  name: wealist-shared-config
  namespace: {{ .Values.global.namespace }}
  labels:
    {{- include "wealist-infrastructure.labels" . | nindent 4 }}
    app.kubernetes.io/component: shared-config
data:
  # Environment
  ENV: {{ .Values.shared.config.ENV | quote }}
  LOG_LEVEL: {{ .Values.shared.config.LOG_LEVEL | quote }}

  # Service Discovery URLs
  AUTH_SERVICE_URL: {{ .Values.shared.config.AUTH_SERVICE_URL | quote }}
  USER_SERVICE_URL: {{ .Values.shared.config.USER_SERVICE_URL | quote }}
  BOARD_SERVICE_URL: {{ .Values.shared.config.BOARD_SERVICE_URL | quote }}
  CHAT_SERVICE_URL: {{ .Values.shared.config.CHAT_SERVICE_URL | quote }}
  NOTI_SERVICE_URL: {{ .Values.shared.config.NOTI_SERVICE_URL | quote }}
  STORAGE_SERVICE_URL: {{ .Values.shared.config.STORAGE_SERVICE_URL | quote }}
  VIDEO_SERVICE_URL: {{ .Values.shared.config.VIDEO_SERVICE_URL | quote }}
  LIVEKIT_WS_URL: {{ .Values.shared.config.LIVEKIT_WS_URL | quote }}

  # Infrastructure URLs
  # DB_HOST, POSTGRES_HOST, REDIS_HOST: Only include when NOT using ExternalSecrets
  # (Production uses ExternalSecret to inject these from AWS Secrets Manager)
  {{- if not .Values.externalSecrets.enabled }}
  DB_HOST: {{ .Values.shared.config.POSTGRES_HOST | quote }}
  POSTGRES_HOST: {{ .Values.shared.config.POSTGRES_HOST | quote }}
  REDIS_HOST: {{ .Values.shared.config.REDIS_HOST | quote }}
  {{- end }}
  DB_PORT: {{ .Values.shared.config.POSTGRES_PORT | quote }}
  POSTGRES_PORT: {{ .Values.shared.config.POSTGRES_PORT | quote }}
  REDIS_PORT: {{ .Values.shared.config.REDIS_PORT | quote }}

  # MinIO/S3
  S3_ENDPOINT: {{ .Values.shared.config.S3_ENDPOINT | quote }}
  S3_PUBLIC_ENDPOINT: {{ .Values.shared.config.S3_PUBLIC_ENDPOINT | quote }}
  S3_BUCKET: {{ .Values.shared.config.S3_BUCKET | quote }}
  S3_REGION: {{ .Values.shared.config.S3_REGION | quote }}

  # CORS & Security
  CORS_ORIGINS: {{ .Values.shared.config.CORS_ORIGINS | quote }}
  {{- if not .Values.externalSecrets.enabled }}
  # INTERNAL_API_KEY: Only include when NOT using ExternalSecrets
  INTERNAL_API_KEY: {{ .Values.shared.config.INTERNAL_API_KEY | quote }}
  {{- end }}
