{{- if and .Values.enabled .Values.ambient.enabled .Values.ambient.waypoint.enabled }}
# Waypoint Proxy for L7 traffic management in Ambient mode
# Handles: VirtualService routing, retries, timeouts, JWT validation
apiVersion: gateway.networking.k8s.io/v1
kind: Gateway
metadata:
  name: {{ .Values.ambient.waypoint.name | default "wealist-waypoint" }}
  namespace: {{ include "istio-config.namespace" . }}
  labels:
    istio.io/waypoint-for: service
    {{- include "istio-config.labels" . | nindent 4 }}
  annotations:
    {{- if .Values.ambient.waypoint.annotations }}
    {{- toYaml .Values.ambient.waypoint.annotations | nindent 4 }}
    {{- end }}
spec:
  gatewayClassName: istio-waypoint
  listeners:
  - name: mesh
    port: 15008
    protocol: HBONE
    allowedRoutes:
      namespaces:
        from: Same
{{- end }}
