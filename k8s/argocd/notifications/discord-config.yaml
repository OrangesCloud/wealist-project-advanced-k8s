apiVersion: v1
kind: ConfigMap
metadata:
  name: argocd-notifications-cm
  namespace: argocd
data:
  # Discord ì„œë¹„ìŠ¤ ì„¤ì • (Webhook ì‚¬ìš©)
  service.discord: |
    token: $discord-webhook-url
  
  # ë°°í¬ ì„±ê³µ í…œí”Œë¦¿ (message í˜•ì‹ë§Œ ì§€ì›)
  template.app-deployed: |
    message: |
      ğŸš€ **ë°°í¬ ì™„ë£Œ**
      
      **ì• í”Œë¦¬ì¼€ì´ì…˜**: {{.app.metadata.name}}
      **í™˜ê²½**: {{.app.metadata.namespace}}
      **ìƒíƒœ**: {{.app.status.health.status}}
      **ë™ê¸°í™”**: {{.app.status.sync.status}}
      **ë¦¬ë¹„ì „**: {{.app.status.sync.revision}}
      **ì‹œê°„**: {{.app.status.operationState.finishedAt}}

  # ë°°í¬ ì‹¤íŒ¨ í…œí”Œë¦¿
  template.app-sync-failed: |
    message: |
      âŒ **ë°°í¬ ì‹¤íŒ¨**
      
      **ì• í”Œë¦¬ì¼€ì´ì…˜**: {{.app.metadata.name}}
      **í™˜ê²½**: {{.app.metadata.namespace}}
      **ì˜¤ë¥˜**: {{.app.status.operationState.message}}
      **ì‹œê°„**: {{.app.status.operationState.finishedAt}}

  # ë°°í¬ ì‹œì‘ í…œí”Œë¦¿
  template.app-sync-running: |
    message: |
      â³ **ë°°í¬ ì‹œì‘**
      
      **ì• í”Œë¦¬ì¼€ì´ì…˜**: {{.app.metadata.name}}
      **í™˜ê²½**: {{.app.metadata.namespace}}
      **ì‹œì‘ ì‹œê°„**: {{.app.status.operationState.startedAt}}

  # íŠ¸ë¦¬ê±° ì„¤ì •
  trigger.on-deployed: |
    - description: ë°°í¬ ì™„ë£Œ ì‹œ ì•Œë¦¼
      send:
      - app-deployed
      when: app.status.operationState.phase in ['Succeeded'] and app.status.health.status == 'Healthy'
  
  trigger.on-sync-failed: |
    - description: ë°°í¬ ì‹¤íŒ¨ ì‹œ ì•Œë¦¼
      send:
      - app-sync-failed
      when: app.status.operationState.phase in ['Error', 'Failed']
  
  trigger.on-sync-running: |
    - description: ë°°í¬ ì‹œì‘ ì‹œ ì•Œë¦¼
      send:
      - app-sync-running
      when: app.status.operationState.phase in ['Running']
---
apiVersion: v1
kind: Secret
metadata:
  name: argocd-notifications-secret
  namespace: argocd
type: Opaque
stringData:
  # Discord Webhook URL (Bot Token ì•„ë‹˜!)
  discord-webhook-url: "https://discord.com/api/webhooks/YOUR_ID/YOUR_TOKEN"