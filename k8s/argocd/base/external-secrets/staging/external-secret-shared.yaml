# =============================================================================
# ExternalSecret - Staging Shared Application Secrets
# =============================================================================
# AWS Secrets Manager에서 시크릿을 가져와 K8s Secret으로 생성
# Terraform으로 AWS Secrets Manager에 값 저장 후 ESO가 자동 동기화

apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: wealist-shared-secret
  namespace: wealist-staging
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: aws-secrets-manager
    kind: ClusterSecretStore

  target:
    name: wealist-shared-secret
    creationPolicy: Owner

  data:
    # -------------------------------------------------------------------------
    # Database Connection (External - RDS or Host)
    # -------------------------------------------------------------------------
    - secretKey: DB_HOST
      remoteRef:
        key: "wealist/staging/database/endpoint"
        property: host

    - secretKey: POSTGRES_HOST
      remoteRef:
        key: "wealist/staging/database/endpoint"
        property: host

    - secretKey: DB_PASSWORD
      remoteRef:
        key: "wealist/staging/database/endpoint"
        property: password

    - secretKey: DB_USERNAME
      remoteRef:
        key: "wealist/staging/database/endpoint"
        property: username

    - secretKey: DB_PORT
      remoteRef:
        key: "wealist/staging/database/endpoint"
        property: port

    # -------------------------------------------------------------------------
    # Redis Connection (External - ElastiCache or Host)
    # -------------------------------------------------------------------------
    - secretKey: REDIS_HOST
      remoteRef:
        key: "wealist/staging/redis/endpoint"
        property: host

    - secretKey: SPRING_REDIS_HOST
      remoteRef:
        key: "wealist/staging/redis/endpoint"
        property: host

    - secretKey: REDIS_PASSWORD
      remoteRef:
        key: "wealist/staging/redis/auth-token"

    - secretKey: SPRING_REDIS_PASSWORD
      remoteRef:
        key: "wealist/staging/redis/auth-token"

    # -------------------------------------------------------------------------
    # Application Secrets
    # -------------------------------------------------------------------------
    - secretKey: JWT_SECRET
      remoteRef:
        key: "wealist/staging/app/jwt-secret"

    - secretKey: INTERNAL_API_KEY
      remoteRef:
        key: "wealist/staging/app/internal-api-key"

    # -------------------------------------------------------------------------
    # OAuth2 Google
    # -------------------------------------------------------------------------
    - secretKey: GOOGLE_CLIENT_ID
      remoteRef:
        key: "wealist/staging/oauth/google"
        property: client_id

    - secretKey: GOOGLE_CLIENT_SECRET
      remoteRef:
        key: "wealist/staging/oauth/google"
        property: client_secret

    # -------------------------------------------------------------------------
    # LiveKit
    # -------------------------------------------------------------------------
    - secretKey: LIVEKIT_API_KEY
      remoteRef:
        key: "wealist/staging/livekit/credentials"
        property: api_key

    - secretKey: LIVEKIT_API_SECRET
      remoteRef:
        key: "wealist/staging/livekit/credentials"
        property: api_secret

    # -------------------------------------------------------------------------
    # MinIO / S3
    # -------------------------------------------------------------------------
    - secretKey: S3_ACCESS_KEY
      remoteRef:
        key: "wealist/staging/minio/credentials"
        property: access_key

    - secretKey: S3_SECRET_KEY
      remoteRef:
        key: "wealist/staging/minio/credentials"
        property: secret_key

    # -------------------------------------------------------------------------
    # Grafana Admin
    # -------------------------------------------------------------------------
    - secretKey: GRAFANA_ADMIN_USER
      remoteRef:
        key: "wealist/staging/monitoring/grafana"
        property: admin_user

    - secretKey: GRAFANA_ADMIN_PASSWORD
      remoteRef:
        key: "wealist/staging/monitoring/grafana"
        property: admin_password
