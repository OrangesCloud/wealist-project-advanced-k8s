# =============================================================================
# ExternalSecret - Shared Application Secrets
# =============================================================================
# AWS Secrets Manager에서 시크릿을 가져와 K8s Secret으로 생성
# 이 Secret은 모든 서비스에서 공유됨

apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: wealist-shared-secret
  namespace: wealist-prod
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: aws-secrets-manager
    kind: ClusterSecretStore

  target:
    name: wealist-shared-secret
    creationPolicy: Owner

  data:
    # -------------------------------------------------------------------------
    # Database Credentials (RDS 자동 관리)
    # -------------------------------------------------------------------------
    - secretKey: DB_PASSWORD
      remoteRef:
        key: "rds!db-wealist-prod-postgres"
        property: password

    # -------------------------------------------------------------------------
    # Redis Credentials (Terraform 생성)
    # -------------------------------------------------------------------------
    - secretKey: REDIS_PASSWORD
      remoteRef:
        key: "wealist/prod/redis/auth-token"

    # -------------------------------------------------------------------------
    # Application Secrets (Terraform 자동 생성)
    # -------------------------------------------------------------------------
    - secretKey: JWT_SECRET
      remoteRef:
        key: "wealist/prod/app/jwt-secret"

    - secretKey: INTERNAL_API_KEY
      remoteRef:
        key: "wealist/prod/app/internal-api-key"

    # -------------------------------------------------------------------------
    # OAuth2 Google (Terraform placeholder → 수동 업데이트 필요)
    # -------------------------------------------------------------------------
    - secretKey: GOOGLE_CLIENT_ID
      remoteRef:
        key: "wealist/prod/oauth/google"
        property: client_id

    - secretKey: GOOGLE_CLIENT_SECRET
      remoteRef:
        key: "wealist/prod/oauth/google"
        property: client_secret

    # -------------------------------------------------------------------------
    # LiveKit (Terraform placeholder → 수동 업데이트 필요)
    # -------------------------------------------------------------------------
    - secretKey: LIVEKIT_API_KEY
      remoteRef:
        key: "wealist/prod/livekit/credentials"
        property: api_key

    - secretKey: LIVEKIT_API_SECRET
      remoteRef:
        key: "wealist/prod/livekit/credentials"
        property: api_secret
