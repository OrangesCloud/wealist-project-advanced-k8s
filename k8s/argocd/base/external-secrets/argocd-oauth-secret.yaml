# =============================================================================
# ExternalSecret - ArgoCD Google OAuth Credentials (Dex SSO)
# =============================================================================
# argocd namespace에 생성되어 argocd-cm의 Dex config에서 참조
# Dex는 $dex.google.clientID 형식으로 이 Secret의 값을 자동 참조
#
# AWS Secrets Manager에 저장:
#   wealist/prod/oauth/google:
#     client_id: "xxx.apps.googleusercontent.com"
#     client_secret: "GOCSPX-xxx"
#
# Google Cloud Console에서 OAuth 클라이언트 생성 시:
#   Redirect URI: https://argocd.wealist.co.kr/api/dex/callback

apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: argocd-oauth-secret
  namespace: argocd
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: aws-secrets-manager
    kind: ClusterSecretStore

  target:
    name: argocd-oauth-secret
    creationPolicy: Owner

  data:
    # Dex가 $dex.google.clientID 형식으로 참조
    - secretKey: dex.google.clientID
      remoteRef:
        key: "wealist/prod/oauth/google"
        property: client_id

    - secretKey: dex.google.clientSecret
      remoteRef:
        key: "wealist/prod/oauth/google"
        property: client_secret
