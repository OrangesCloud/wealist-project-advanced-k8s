# =============================================================================
# ExternalSecret - LiveKit API Keys
# =============================================================================
# LiveKit Helm Chart가 요구하는 keys.yaml 형식으로 변환
# storeKeysInSecret.existingSecret에서 참조됨

apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: wealist-livekit-keys
  namespace: wealist-prod
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: aws-secrets-manager
    kind: ClusterSecretStore

  target:
    name: wealist-livekit-keys
    creationPolicy: Owner
    template:
      type: Opaque
      # LiveKit Helm Chart는 keys.yaml 파일을 기대함
      # 형식: api_key: api_secret
      data:
        keys.yaml: |
          {{ .api_key }}: {{ .api_secret }}

  data:
    - secretKey: api_key
      remoteRef:
        key: "wealist/prod/livekit/credentials"
        property: api_key

    - secretKey: api_secret
      remoteRef:
        key: "wealist/prod/livekit/credentials"
        property: api_secret
