# =============================================================================
# chat-service - Service Configuration
# =============================================================================
# Global settings (namespace, environment, imageRegistry, domain) are defined
# in helm/environments/*.yaml files.

# -----------------------------------------------------------------------------
# Image Configuration
# -----------------------------------------------------------------------------
image:
  repository: chat-service
  # pullPolicy and tag are set in helm/environments/*.yaml

imagePullSecrets: []

# -----------------------------------------------------------------------------
# Deployment Configuration
# -----------------------------------------------------------------------------
replicaCount: 2

strategy:
  type: RollingUpdate
  rollingUpdate:
    maxSurge: 1
    maxUnavailable: 0

# -----------------------------------------------------------------------------
# Service Configuration
# -----------------------------------------------------------------------------
service:
  type: ClusterIP
  port: 8001
  targetPort: 8001
  annotations: {}

# -----------------------------------------------------------------------------
# Application Configuration (Service-Specific Only)
# -----------------------------------------------------------------------------
# Note: Common config (ENV, LOG_LEVEL, DB_HOST, DB_PORT, REDIS_HOST, REDIS_PORT,
# S3_*, AUTH_SERVICE_URL, USER_SERVICE_URL, etc.) comes from
# helm/environments/*.yaml via shared.config section.
# Only service-specific values should be defined here.
config:
  # Server (service-specific port)
  PORT: "8001"
  SERVER_PORT: "8001"
  SERVER_BASE_PATH: "/api/chats"

  # Database (service-specific)
  DB_NAME: "wealist_chat_service_db"
  DATABASE_URL: "postgresql://chat_service:chat_service_password@postgres:5432/wealist_chat_service_db?sslmode=disable"

# -----------------------------------------------------------------------------
# External Secrets
# -----------------------------------------------------------------------------
externalSecrets:
  enabled: false
  secretStore: aws-secrets-manager
  secretStoreKind: ClusterSecretStore
  refreshInterval: 1h

# -----------------------------------------------------------------------------
# Health Check Configuration
# -----------------------------------------------------------------------------
healthCheck:
  liveness:
    path: /health/live
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    successThreshold: 1
    failureThreshold: 3
  readiness:
    path: /health/ready
    initialDelaySeconds: 20
    periodSeconds: 5
    timeoutSeconds: 3
    successThreshold: 1
    failureThreshold: 3

# -----------------------------------------------------------------------------
# Resource Management
# -----------------------------------------------------------------------------
resources:
  requests:
    memory: "256Mi"
    cpu: "100m"
  limits:
    memory: "512Mi"
    cpu: "500m"

# -----------------------------------------------------------------------------
# Autoscaling
# -----------------------------------------------------------------------------
autoscaling:
  enabled: true
  minReplicas: 2
  maxReplicas: 10
  targetCPUUtilizationPercentage: 70
  targetMemoryUtilizationPercentage: 80
  behavior:
    scaleDown:
      stabilizationWindowSeconds: 300
      policies:
        - type: Percent
          value: 50
          periodSeconds: 60
        - type: Pods
          value: 1
          periodSeconds: 60
      selectPolicy: Min
    scaleUp:
      stabilizationWindowSeconds: 0
      policies:
        - type: Percent
          value: 100
          periodSeconds: 30
        - type: Pods
          value: 2
          periodSeconds: 30
      selectPolicy: Max

# -----------------------------------------------------------------------------
# Security
# -----------------------------------------------------------------------------
podSecurityContext:
  runAsNonRoot: true
  runAsUser: 1000
  fsGroup: 1000
  seccompProfile:
    type: RuntimeDefault

securityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop:
      - ALL
  readOnlyRootFilesystem: false
  runAsNonRoot: true
  runAsUser: 1000

# -----------------------------------------------------------------------------
# Service Account
# -----------------------------------------------------------------------------
serviceAccount:
  create: true
  annotations: {}
  name: ""
  automount: true

# -----------------------------------------------------------------------------
# Pod Disruption Budget
# -----------------------------------------------------------------------------
podDisruptionBudget:
  enabled: true
  minAvailable: 1

# -----------------------------------------------------------------------------
# Network Policy
# -----------------------------------------------------------------------------
networkPolicy:
  enabled: false

# -----------------------------------------------------------------------------
# Monitoring
# -----------------------------------------------------------------------------
metrics:
  enabled: true
  path: /metrics

podAnnotations: {}

nodeSelector: {}
tolerations: []
affinity: {}

extraEnv: []
extraEnvFrom: []
extraVolumes: []
extraVolumeMounts: []
