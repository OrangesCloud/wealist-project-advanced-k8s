spring:
  application:
    name: ${APP_NAME:wealist-auth}

  jackson:
    serialization:
      write-dates-as-timestamps: false
    deserialization:
      fail-on-unknown-properties: false
      adjust-dates-to-context-time-zone: false
    default-property-inclusion: non_null
    mapper:
      accept-case-insensitive-enums: true

  data:
    redis:
      host: ${SPRING_REDIS_HOST:localhost}
      port: ${SPRING_REDIS_PORT:6379}
      password: ${SPRING_REDIS_PASSWORD:}

  # Spring Session Redis 설정 (OAuth2 state 공유)
  session:
    store-type: redis
    redis:
      namespace: wealist:auth:session

  # Google OAuth2 설정
  security:
    oauth2:
      client:
        registration:
          google:
            client-id: ${GOOGLE_CLIENT_ID:}
            client-secret: ${GOOGLE_CLIENT_SECRET:}
            scope:
              - email
              - profile
            redirect-uri: ${OAUTH2_CLIENT_REDIRECT_URI:http://localhost:8080/oauth2/callback/google}
            authorization-grant-type: authorization_code
            client-name: Google
        provider:
          google:
            authorization-uri: https://accounts.google.com/o/oauth2/v2/auth
            token-uri: https://oauth2.googleapis.com/token
            user-info-uri: https://www.googleapis.com/oauth2/v3/userinfo
            user-name-attribute: sub

springdoc:
  swagger-ui:
    path: /swagger-ui.html
    tags-sorter: alpha
    operations-sorter: alpha
    display-request-duration: true
    disable-swagger-default-url: true

server:
  port: ${AUTH_SERVICE_PORT:8080}
  # Trust X-Forwarded-* headers from reverse proxy (CloudFront/nginx)
  forward-headers-strategy: native
  error:
    whitelabel.enabled: false
    include-exception: true
  servlet:
    context-path: ""

jwt:
  # RSA 키 설정 (RS256 알고리즘)
  rsa:
    # PEM 형식 공개키 (선택적 - 없으면 자동 생성)
    public-key: ${JWT_RSA_PUBLIC_KEY:}
    # PEM 형식 개인키 (선택적 - 없으면 자동 생성)
    private-key: ${JWT_RSA_PRIVATE_KEY:}
    # 키 ID (JWKS kid 필드)
    key-id: ${JWT_RSA_KEY_ID:wealist-auth-key-1}
  # JWT issuer (토큰 발급자)
  issuer: ${JWT_ISSUER:wealist-auth-service}
  # 토큰 만료 시간
  access-token-expiration-ms: ${JWT_ACCESS_TOKEN_EXPIRATION_MS:1800000}
  refresh-token-expiration-ms: ${JWT_REFRESH_TOKEN_EXPIRATION_MS:604800000}

# OAuth2 리다이렉트 URL (프론트엔드)
oauth2:
  redirect-url: ${OAUTH2_REDIRECT_URL_ENV:http://localhost:3000/oauth/callback}
  # 허용된 redirect URI 패턴 (보안)
  # 클라이언트가 redirect_uri 파라미터로 전달하면 이 패턴과 일치해야 함
  allowed-redirect-patterns:
    - https://wealist.co.kr/**
    - https://dev.wealist.co.kr/**
    - http://localhost:3000/**
    - http://localhost:3001/**

# User Service URL (유저 조회/생성용)
user-service:
  url: ${USER_SERVICE_URL:http://localhost:8081}

logging:
  level:
    OrangeCloud: DEBUG
    org.springframework.security: DEBUG
  # Trace ID를 로그에 포함 (Traces-Logs Correlation)
  pattern:
    level: "%5p [${spring.application.name:},%X{traceId:-},%X{spanId:-}]"

management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
      base-path: /actuator
  endpoint:
    health:
      show-details: always
      # Kubernetes probe 지원 활성화
      probes:
        enabled: true
      # Health group 정의: liveness는 서비스 자체만, readiness는 Redis 포함
      group:
        liveness:
          include: livenessState
        readiness:
          include: readinessState, redis
  # Health indicator 활성화
  health:
    livenessState:
      enabled: true
    readinessState:
      enabled: true
    redis:
      enabled: true
  metrics:
    export:
      enabled: true
    tags:
      application: ${spring.application.name}
  prometheus:
    metrics:
      export:
        enabled: true
  # OpenTelemetry Tracing (분산 추적)
  tracing:
    enabled: ${OTEL_TRACING_ENABLED:true}
    sampling:
      probability: ${OTEL_TRACES_SAMPLER_ARG:1.0}
  otlp:
    tracing:
      # Spring Boot needs full path with /v1/traces (unlike Go SDK which adds it automatically)
      # Use separate env var to avoid conflict with Go services' OTEL_EXPORTER_OTLP_ENDPOINT
      endpoint: ${OTEL_EXPORTER_OTLP_TRACES_ENDPOINT:http://otel-collector:4318/v1/traces}
