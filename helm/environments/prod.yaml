# =============================================================================
# Production Environment
# =============================================================================
# Production environment with full security and HA
# Namespace: wealist-prod

# -----------------------------------------------------------------------------
# Global Settings
# -----------------------------------------------------------------------------
global:
  namespace: wealist-prod
  environment: production
  domain: wealist.co.kr
  imageRegistry: ghcr.io/orangescloud

# -----------------------------------------------------------------------------
# Deployment Settings
# -----------------------------------------------------------------------------
replicaCount: 3  # High availability

image:
  pullPolicy: IfNotPresent

# -----------------------------------------------------------------------------
# Resources (Production)
# -----------------------------------------------------------------------------
resources:
  requests:
    memory: "256Mi"
    cpu: "200m"
  limits:
    memory: "1Gi"
    cpu: "1000m"

# -----------------------------------------------------------------------------
# Health Check
# -----------------------------------------------------------------------------
healthCheck:
  liveness:
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3
  readiness:
    initialDelaySeconds: 10
    periodSeconds: 5
    timeoutSeconds: 3
    failureThreshold: 3

# -----------------------------------------------------------------------------
# Security (Hardened)
# -----------------------------------------------------------------------------
podSecurityContext:
  runAsNonRoot: true
  fsGroup: 1000
  seccompProfile:
    type: RuntimeDefault

securityContext:
  allowPrivilegeEscalation: false
  runAsNonRoot: true
  readOnlyRootFilesystem: true
  capabilities:
    drop:
      - ALL

# -----------------------------------------------------------------------------
# Features (Full production features)
# -----------------------------------------------------------------------------
autoscaling:
  enabled: true
  minReplicas: 3
  maxReplicas: 10
  targetCPUUtilizationPercentage: 70
  targetMemoryUtilizationPercentage: 80

serviceAccount:
  create: true
  annotations:
    eks.amazonaws.com/role-arn: ""  # Add IAM role ARN if using AWS

networkPolicy:
  enabled: true

podDisruptionBudget:
  enabled: true
  minAvailable: 2

# -----------------------------------------------------------------------------
# Shared Configuration
# -----------------------------------------------------------------------------
shared:
  config:
    ENV: "production"
    LOG_LEVEL: "info"
    CORS_ORIGINS: "https://wealist.co.kr,https://www.wealist.co.kr"
    S3_PUBLIC_ENDPOINT: "https://cdn.wealist.co.kr"
    LIVEKIT_WS_URL: "wss://wealist.co.kr/svc/livekit"
    # OAuth2 Redirect URLs
    OAUTH2_CLIENT_REDIRECT_URI: "https://wealist.co.kr/oauth2/callback/google"
    OAUTH2_REDIRECT_URL_ENV: "https://wealist.co.kr/oauth/callback"

# -----------------------------------------------------------------------------
# Metrics & Monitoring (Enhanced)
# -----------------------------------------------------------------------------
metrics:
  enabled: true
  serviceMonitor:
    enabled: true
    interval: 30s

# -----------------------------------------------------------------------------
# Ingress
# -----------------------------------------------------------------------------
ingress:
  enabled: true
  className: nginx
  # Frontend is served via S3/CloudFront, not K8s
  includeFrontend: false
  annotations:
    cert-manager.io/cluster-issuer: letsencrypt-prod
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    nginx.ingress.kubernetes.io/rate-limit: "100"
    nginx.ingress.kubernetes.io/rate-limit-window: "1m"
  hosts:
    - host: wealist.co.kr
    - host: www.wealist.co.kr
  tls:
    - secretName: wealist-prod-tls
      hosts:
        - wealist.co.kr
        - www.wealist.co.kr

# -----------------------------------------------------------------------------
# Node Affinity (Spread across AZs)
# -----------------------------------------------------------------------------
affinity:
  podAntiAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        podAffinityTerm:
          labelSelector:
            matchLabels:
              app.kubernetes.io/name: "{{ .Release.Name }}"
          topologyKey: topology.kubernetes.io/zone
